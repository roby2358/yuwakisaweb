<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markov Generator</title>
    <link rel="stylesheet" href="css/index.css">
</head>
<body>
    <div class="container">
        <div class="tabs">
            <button class="tab active" data-tab="source">source</button>
            <button class="tab" data-tab="generated">generated</button>
            <button class="tab" data-tab="about">about</button>
        </div>
        <div id="message-bar" class="message-bar" aria-live="polite">&nbsp;</div>
        
        <div class="panel active" id="source-panel">
            <div class="tokenization-options">
                <label class="radio-label">
                    <input type="radio" name="tokenization" value="characters" checked>
                    <span>words</span>
                </label>
                <label class="radio-label">
                    <input type="radio" name="tokenization" value="words">
                    <span>text</span>
                </label>
                <label class="radio-label">
                    <input type="radio" name="tokenization" value="gpt">
                    <span>gpt</span>
                </label>
                <label class="radio-label">
                    <input type="radio" name="tokenization" value="phonetic">
                    <span>phonetic</span>
                </label>
            </div>
            <div class="source-actions">
                <button class="action-button" id="calculate-btn">calculate</button>
                <button class="action-button" id="no-newlines-btn">no newlines</button>
                <button class="action-button" id="tweets-btn">tweets</button>
            </div>
            <textarea id="source-text" placeholder="Enter source text here..." autocomplete="off"></textarea>
        </div>
        
        <div class="panel" id="generated-panel">
            <div class="generate-controls">
                <input type="number" id="output-length" value="10" min="1" class="length-input">
                <button class="action-button" id="generate-btn">generate</button>
                <button class="action-button" id="speak-btn">speak</button>
                <button class="action-button" id="translate-btn">translate</button>
            </div>
            <textarea id="generated-text" placeholder="Generated text will appear here..." readonly autocomplete="off"></textarea>
        </div>
        
        <div class="panel" id="about-panel">
            <p>This Markov chain text generator offers three modes:</p>
            <ul>
                <li><strong>Words mode:</strong> generates individual words character-by-character using adaptive n-grams (1-N tokens).</li>
                <li><strong>Text mode:</strong> generates flowing paragraphs word-by-word with paragraph-aware boundaries.</li>
                <li><strong>GPT mode:</strong> generates text using GPT tokenizer (BPE tokens) with token-level n-grams.</li>
                <li><strong>Phonetic mode:</strong> converts text to IPA phonemes and generates phonetically plausible words. Use the Speak button to hear generated text aloud.</li>
            </ul>
            <p>Words and Text modes handle punctuation intelligently. Paired punctuation (quotes, brackets) is removed to avoid pairing errors, while unpaired punctuation (periods, commas, dashes) is properly separated and formatted. GPT mode uses the tokenizer's built-in punctuation handling.</p>
            <p><strong>Differences from vanilla Markov chains:</strong></p>
            <p>Instead of a fixed n-gram size, this implementation generates all possible prefix-suffix pairs from 1 to N tokens and randomly selects a prefix length weighted by frequency at each generation step.</p>
            <p>This adaptive approach better captures patterns at multiple scales.</p>
        </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://unpkg.com/gpt-tokenizer@2.1.2/dist/cl100k_base.js"></script>
    <script>
        (function initialiseGptTokenizer() {
            if (typeof GPTTokenizer_cl100k_base === 'undefined') {
                console.error('GPT tokenizer script failed to load. GPT mode will be unavailable.');
                return;
            }

            const tokenizerModule = GPTTokenizer_cl100k_base;
            if (!tokenizerModule || typeof tokenizerModule.encode !== 'function' || typeof tokenizerModule.decode !== 'function') {
                console.error('GPT tokenizer module did not expose encode/decode functions.');
                return;
            }

            window.gptTokenizer = {
                encode: (text) => {
                    try {
                        return tokenizerModule.encode(text);
                    } catch (error) {
                        console.error('GPT encode error:', error);
                        return [];
                    }
                },
                decode: (tokenIds) => {
                    try {
                        return tokenizerModule.decode(tokenIds);
                    } catch (error) {
                        console.error('GPT decode error:', error);
                        return '';
                    }
                }
            };

            console.log('GPT tokenizer initialized via gpt-tokenizer cl100k_base bundle.');
        })();
    </script>
    <script src="js/markov.js"></script>
    <script src="js/tokenize.js"></script>
    <script src="js/words.js"></script>
    <script src="js/text.js"></script>
    <script src="js/gpt.js"></script>
    <script src="js/espeakng/espeakng.min.js"></script>
    <script src="js/espeakng/espeakng-simple.js"></script>
    <script src="js/espeak.js"></script>
    <script src="js/phonetic.js"></script>
    <script src="js/tweet-cleaner.js"></script>
    <script src="js/index.js"></script>
</body>
</html>
